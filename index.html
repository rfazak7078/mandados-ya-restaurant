
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mandados YA - Portal Restaurantes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hidden { display: none; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Login Screen -->
    <div id="loginScreen">
        <header class="bg-white shadow-sm">
            <div class="max-w-7xl mx-auto px-4 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="bg-orange-500 text-white p-2 rounded-lg">
                            <span class="text-xl">üè™</span>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold text-gray-900">Mandados YA</h1>
                            <p class="text-sm text-gray-500">Portal de Restaurantes</p>
                        </div>
                    </div>
                    <div class="bg-orange-100 text-orange-600 px-3 py-1 rounded-full text-sm">
                        Trinidad ‚Ä¢ Flores ‚Ä¢ Durazno
                    </div>
                </div>
            </div>
        </header>

        <main class="max-w-6xl mx-auto px-4 py-8">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-gray-900 mb-4">Panel de Gesti√≥n de Restaurantes</h2>
                <p class="text-lg text-gray-600">Gestiona tus pedidos en tiempo real, ve qui√©n viene a buscarlos y mant√©n a tus clientes informados.</p>
            </div>

            <div class="grid lg:grid-cols-2 gap-8 mb-12">
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <div class="flex items-center space-x-2 mb-4">
                        <svg class="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                            <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
                        </svg>
                        <h3 class="font-semibold">Acceso al Sistema</h3>
                    </div>
                    <div id="loginError" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
                        Credenciales incorrectas. Contacta al administrador.
                    </div>
                    <form class="space-y-4" onsubmit="loginRestaurant(event)">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Usuario del Restaurante</label>
                            <input type="text" id="username" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="Ej: pizzanapoli" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Contrase√±a</label>
                            <input type="password" id="password" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="Tu contrase√±a" required>
                        </div>
                        <button type="submit" class="w-full bg-orange-500 hover:bg-orange-600 text-white py-2 px-4 rounded-md">
                            Acceder al Panel
                        </button>
                    </form>
                </div>

                <div class="bg-white rounded-xl shadow-sm p-6">
                    <div class="flex items-center space-x-2 mb-4">
                        <svg class="w-5 h-5 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z"/>
                        </svg>
                        <h3 class="font-semibold">¬øQu√© puedes hacer?</h3>
                    </div>
                    <div class="space-y-4">
                        <div class="flex items-start space-x-3">
                            <div class="bg-green-100 p-2 rounded-lg">üìû</div>
                            <div>
                                <h4 class="font-medium">Recibir Pedidos</h4>
                                <p class="text-sm text-gray-600">Ve todos los pedidos nuevos en tiempo real con notificaciones</p>
                            </div>
                        </div>
                        <div class="flex items-start space-x-3">
                            <div class="bg-blue-100 p-2 rounded-lg">üìç</div>
                            <div>
                                <h4 class="font-medium">Ver Repartidor</h4>
                                <p class="text-sm text-gray-600">Informaci√≥n completa de qui√©n viene a buscar cada pedido</p>
                            </div>
                        </div>
                        <div class="flex items-start space-x-3">
                            <div class="bg-purple-100 p-2 rounded-lg">üè™</div>
                            <div>
                                <h4 class="font-medium">Gestionar Estados</h4>
                                <p class="text-sm text-gray-600">Confirma, prepara y marca pedidos listos para recoger</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-blue-50 rounded-lg p-6 text-center">
                <h3 class="text-lg font-semibold text-blue-900 mb-2">¬øNo tienes acceso a√∫n?</h3>
                <p class="text-blue-700 mb-4">Contacta al administrador del sistema para registrar tu restaurante</p>
                <div class="text-sm text-blue-600">
                    <p><strong>Email:</strong> admin@mandadosya.net</p>
                    <p><strong>Tel√©fono:</strong> +598 99 123 456</p>
                </div>
            </div>
        </main>
    </div>

    <!-- Restaurant Dashboard -->
    <div id="restaurantDashboard" class="hidden">
        <header class="bg-white shadow-sm border-b">
            <div class="flex items-center justify-between px-6 py-4">
                <div class="flex items-center space-x-3">
                    <span class="text-2xl">üè™</span>
                    <div>
                        <h1 class="text-xl font-bold text-gray-900" id="restaurantName">Restaurante</h1>
                        <p class="text-sm text-gray-500">Panel de Gesti√≥n</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="bg-green-100 text-green-600 px-3 py-1 rounded-full text-sm">
                        üü¢ En l√≠nea
                    </div>
                    <button onclick="logout()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm">
                        Cerrar Sesi√≥n
                    </button>
                </div>
            </div>
        </header>

        <div class="max-w-7xl mx-auto px-4 py-8">
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white p-6 rounded-xl shadow-sm border">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-500">Pedidos Hoy</p>
                            <p class="text-2xl font-bold text-blue-600" id="todayOrders">0</p>
                        </div>
                        <div class="bg-blue-100 p-3 rounded-full">
                            <span class="text-xl">üì¶</span>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm border">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-500">Ingresos Hoy</p>
                            <p class="text-2xl font-bold text-green-600" id="todayRevenue">$0</p>
                        </div>
                        <div class="bg-green-100 p-3 rounded-full">
                            <span class="text-xl">üí∞</span>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm border">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-500">Pendientes</p>
                            <p class="text-2xl font-bold text-orange-600" id="pendingOrders">0</p>
                        </div>
                        <div class="bg-orange-100 p-3 rounded-full">
                            <span class="text-xl">‚è≥</span>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm border">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-500">Rating</p>
                            <p class="text-2xl font-bold text-purple-600" id="restaurantRating">4.8‚≠ê</p>
                        </div>
                        <div class="bg-purple-100 p-3 rounded-full">
                            <span class="text-xl">‚≠ê</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pending Orders Section -->
            <div class="bg-white rounded-xl shadow-sm border mb-8">
                <div class="p-6 border-b">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold">üîî Pedidos Pendientes de Confirmaci√≥n</h3>
                        <div class="bg-red-100 text-red-600 px-3 py-1 rounded-full text-sm">
                            <span id="pendingCount">0</span> pendientes
                        </div>
                    </div>
                </div>
                <div class="p-6">
                    <div id="pendingOrdersList" class="space-y-4">
                        <div class="text-center py-8 text-gray-500">
                            <span class="text-4xl">üì≠</span>
                            <p class="mt-2">No hay pedidos pendientes</p>
                            <p class="text-sm">Los nuevos pedidos aparecer√°n aqu√≠ para que los confirmes</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Active Orders Section -->
            <div class="bg-white rounded-xl shadow-sm border">
                <div class="p-6 border-b">
                    <h3 class="text-lg font-semibold">üìã Pedidos Activos</h3>
                </div>
                <div class="p-6">
                    <div id="activeOrdersList" class="space-y-4">
                        <!-- Demo orders -->
                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <div class="flex items-center justify-between mb-2">
                                        <h4 class="font-semibold text-gray-900">#001 - Pizza Margherita x2</h4>
                                        <span class="bg-blue-100 text-blue-600 px-2 py-1 rounded-full text-xs">Preparando</span>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600">
                                        <div>
                                            <p><strong>Cliente:</strong> Juan P√©rez</p>
                                            <p><strong>Tel√©fono:</strong> +598 99 123 456</p>
                                        </div>
                                        <div>
                                            <p><strong>Direcci√≥n:</strong> 18 de Julio 1523, Apto 4B</p>
                                            <p><strong>Hora pedido:</strong> 14:30</p>
                                        </div>
                                        <div>
                                            <p><strong>Repartidor:</strong> Ana Mart√≠nez</p>
                                            <p><strong>Veh√≠culo:</strong> üö¥‚Äç‚ôÄÔ∏è Bicicleta</p>
                                        </div>
                                    </div>
                                    <div class="mt-3 flex items-center justify-between">
                                        <div class="text-lg font-bold text-green-600">Total: $450</div>
                                        <div class="space-x-2">
                                            <select class="border rounded px-3 py-1 text-sm">
                                                <option>Preparando</option>
                                                <option>Listo para recoger</option>
                                                <option>Entregado</option>
                                            </select>
                                            <button class="bg-blue-500 text-white px-4 py-1 rounded text-sm hover:bg-blue-600">
                                                üí¨ Chat
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <div class="flex items-center justify-between mb-2">
                                        <h4 class="font-semibold text-gray-900">#002 - Combo Familiar</h4>
                                        <span class="bg-green-100 text-green-600 px-2 py-1 rounded-full text-xs">Listo</span>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600">
                                        <div>
                                            <p><strong>Cliente:</strong> Mar√≠a Garc√≠a</p>
                                            <p><strong>Tel√©fono:</strong> +598 99 234 567</p>
                                        </div>
                                        <div>
                                            <p><strong>Direcci√≥n:</strong> Rivera 567, Casa 12</p>
                                            <p><strong>Hora pedido:</strong> 14:45</p>
                                        </div>
                                        <div>
                                            <p><strong>Repartidor:</strong> Carlos Rodr√≠guez</p>
                                            <p><strong>Veh√≠culo:</strong> üèçÔ∏è Moto</p>
                                        </div>
                                    </div>
                                    <div class="mt-3 flex items-center justify-between">
                                        <div class="text-lg font-bold text-green-600">Total: $890</div>
                                        <div class="space-x-2">
                                            <select class="border rounded px-3 py-1 text-sm">
                                                <option>Preparando</option>
                                                <option selected>Listo para recoger</option>
                                                <option>Entregado</option>
                                            </select>
                                            <button class="bg-blue-500 text-white px-4 py-1 rounded text-sm hover:bg-blue-600">
                                                üí¨ Chat
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentRestaurant = null;
        let pendingOrders = [];
        let activeOrders = [];

        // Get restaurant data from admin system
        function getRestaurants() {
            const restaurants = localStorage.getItem('mandados_restaurants');
            return restaurants ? JSON.parse(restaurants) : [];
        }

        // Login function
        function loginRestaurant(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value.toLowerCase();
            const password = document.getElementById('password').value;
            
            const restaurants = getRestaurants();
            const restaurant = restaurants.find(r => 
                r.username.toLowerCase() === username && r.password === password
            );

            if (restaurant) {
                currentRestaurant = restaurant;
                showDashboard();
                hideLoginError();
            } else {
                showLoginError();
            }
        }

        function showDashboard() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('restaurantDashboard').classList.remove('hidden');
            document.getElementById('restaurantName').textContent = currentRestaurant.name;
            
            // Load dashboard data
            loadDashboardStats();
            startOrderNotifications();
        }

        function showLoginError() {
            document.getElementById('loginError').classList.remove('hidden');
        }

        function hideLoginError() {
            document.getElementById('loginError').classList.add('hidden');
        }

        function logout() {
            if (confirm('¬øEst√°s seguro de cerrar sesi√≥n?')) {
                currentRestaurant = null;
                document.getElementById('restaurantDashboard').classList.add('hidden');
                document.getElementById('loginScreen').classList.remove('hidden');
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                hideLoginError();
            }
        }

        function loadDashboardStats() {
            // Simulate stats based on restaurant data
            const stats = {
                todayOrders: Math.floor(Math.random() * 20) + 5,
                todayRevenue: Math.floor(Math.random() * 5000) + 1000,
                pendingOrders: pendingOrders.length,
                rating: (4.5 + Math.random() * 0.5).toFixed(1)
            };

            document.getElementById('todayOrders').textContent = stats.todayOrders;
            document.getElementById('todayRevenue').textContent = `$${stats.todayRevenue.toLocaleString()}`;
            document.getElementById('pendingOrders').textContent = stats.pendingOrders;
            document.getElementById('restaurantRating').textContent = `${stats.rating}‚≠ê`;
            document.getElementById('pendingCount').textContent = stats.pendingOrders;
        }

        function startOrderNotifications() {
            // Simulate new orders every 30 seconds
            setInterval(() => {
                if (Math.random() > 0.7) { // 30% chance
                    simulateNewOrder();
                }
            }, 30000);
        }

        function simulateNewOrder() {
            const orderItems = [
                'Pizza Margherita x2',
                'Combo Familiar',
                'Sushi Variado x1',
                'Hamburguesa Completa',
                'Pasta Bolognesa',
                'Ensalada C√©sar',
                'Milanesa con Fritas'
            ];

            const customers = [
                { name: 'Juan P√©rez', phone: '+598 99 123 456', address: '18 de Julio 1523' },
                { name: 'Mar√≠a Garc√≠a', phone: '+598 99 234 567', address: 'Rivera 567' },
                { name: 'Carlos L√≥pez', phone: '+598 99 345 678', address: 'Colonia 890' },
                { name: 'Ana Mart√≠nez', phone: '+598 99 456 789', address: 'Sarandi 234' }
            ];

            const newOrder = {
                id: Date.now(),
                items: orderItems[Math.floor(Math.random() * orderItems.length)],
                customer: customers[Math.floor(Math.random() * customers.length)],
                total: Math.floor(Math.random() * 800) + 200,
                time: new Date().toLocaleTimeString('es-UY', { hour: '2-digit', minute: '2-digit' })
            };

            pendingOrders.push(newOrder);
            updatePendingOrdersList();
            playNotificationSound();
            
            // Show browser notification if permission granted
            if (Notification.permission === 'granted') {
                new Notification('üîî Nuevo Pedido!', {
                    body: `${newOrder.items} - $${newOrder.total}`,
                    icon: 'üè™'
                });
            }
        }

        function updatePendingOrdersList() {
            const container = document.getElementById('pendingOrdersList');
            
            if (pendingOrders.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <span class="text-4xl">üì≠</span>
                        <p class="mt-2">No hay pedidos pendientes</p>
                        <p class="text-sm">Los nuevos pedidos aparecer√°n aqu√≠ para que los confirmes</p>
                    </div>
                `;
            } else {
                container.innerHTML = pendingOrders.map(order => `
                    <div class="border-l-4 border-red-500 bg-red-50 p-4 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <h4 class="font-semibold text-gray-900 mb-2">üÜï ${order.items}</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-700 mb-3">
                                    <div>
                                        <p><strong>Cliente:</strong> ${order.customer.name}</p>
                                        <p><strong>Tel√©fono:</strong> ${order.customer.phone}</p>
                                    </div>
                                    <div>
                                        <p><strong>Direcci√≥n:</strong> ${order.customer.address}</p>
                                        <p><strong>Hora:</strong> ${order.time}</p>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="text-lg font-bold text-green-600">Total: $${order.total}</div>
                                    <div class="space-x-2">
                                        <button onclick="confirmOrder(${order.id})" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded font-semibold">
                                            ‚úÖ Confirmar Pedido
                                        </button>
                                        <button onclick="rejectOrder(${order.id})" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">
                                            ‚ùå Rechazar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            // Update counter
            document.getElementById('pendingCount').textContent = pendingOrders.length;
            document.getElementById('pendingOrders').textContent = pendingOrders.length;
        }

        function confirmOrder(orderId) {
            const order = pendingOrders.find(o => o.id === orderId);
            if (order) {
                // Remove from pending
                pendingOrders = pendingOrders.filter(o => o.id !== orderId);
                
                // Add to active orders
                activeOrders.push({
                    ...order,
                    status: 'confirmado',
                    confirmedAt: new Date().toLocaleTimeString('es-UY')
                });

                updatePendingOrdersList();
                
                // Show success message
                alert(`‚úÖ Pedido confirmado!\n\nEl pago ha sido procesado y el pedido ha sido enviado a los repartidores disponibles.\n\nTotal: $${order.total}`);
                
                // Simulate notifying drivers
                setTimeout(() => {
                    alert(`üì¢ Notificaci√≥n enviada a repartidores:\n"Nuevo pedido disponible en ${currentRestaurant.name}\nEntrega: ${order.customer.address}\nPago: $${Math.floor(order.total * 0.15)} por delivery"`);
                }, 2000);
            }
        }

        function rejectOrder(orderId) {
            if (confirm('¬øEst√°s seguro de rechazar este pedido?')) {
                pendingOrders = pendingOrders.filter(o => o.id !== orderId);
                updatePendingOrdersList();
                alert('‚ùå Pedido rechazado. El pago del cliente ha sido reembolsado.');
            }
        }

        function playNotificationSound() {
            // Create audio context for notification sound
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 800;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        // Request notification permission on page load
        document.addEventListener('DOMContentLoaded', function() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
        });

        // Simulate some initial pending orders for demo
        setTimeout(() => {
            if (currentRestaurant) {
                simulateNewOrder();
            }
        }, 5000);
    </script>
</body>
</html>
